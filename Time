import time
import threading
import queue
import tkinter as tk
from tkinter import messagebox
import os

opcion = ""

#Aca se configura el tkinter
root = tk.Tk()
root.withdraw()

def leer_input(q):
    """Lee input() sin bloquear el hilo principal"""
    q.put(input("\nOpcion: ").strip())

while True:
    print("Selecciona la opcion: ")
    q = queue.Queue()
    hilo = threading.Thread(target=leer_input, args=(q,), daemon=True)
    hilo.start()

    start = time.time()
    tiempo_max = 60  #SE establece que el tiempo maximo de espera es 1 minuto
    mensaje_mostrado = False

    while True:
        if not q.empty():
            opcion = q.get()
            if opcion:
                print("Opcion elegida:", opcion)
            break

        #Aca muestra el mensaje solo si se paso el minuto
        if not mensaje_mostrado and time.time() - start >= tiempo_max:
            respuesta = messagebox.askyesno("Tiempo agotado", "Ya ha pasado 1 minuto. Â¿Deseas seguir?")
            mensaje_mostrado = True
            if not respuesta:
                messagebox.showinfo("Aviso", "Volviendo a pantalla inicial...")
                opcion = None
            break

        try:
            root.update()
        except tk.TclError:
            pass

        time.sleep(0.1)

    #Aca se guardara solo si si escribio el usuario
    if opcion:
        ruta = os.path.abspath("registro.txt")
        with open(ruta, "a", encoding="utf-8") as archivo:
            archivo.write(f"Opcion: {opcion}\n")

        messagebox.showinfo("Guardado", "Datos guardados en:/n{ruta}. ")
        break

    if opcion is None:
        break

root.destroy()
